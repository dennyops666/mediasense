# 后端测试计划

## 1. 测试概述

### 1.1 测试目标
- 验证所有后端功能模块的正确性和稳定性
- 确保系统性能满足需求
- 发现并修复潜在的缺陷和安全问题
- 验证系统的可扩展性和可维护性

### 1.2 测试范围
- 单元测试
- 集成测试
- 性能测试
- 安全测试

### 1.3 测试优先级
- P0: 阻塞性问题（需立即解决）
  - 影响系统核心功能的严重缺陷
  - 导致系统无法启动或崩溃的问题
  - 数据安全相关的严重漏洞
  - 影响生产环境稳定性的问题

- P1: 核心功能问题（影响业务运行）
  - 核心业务流程的功能缺陷
  - 影响用户主要使用场景的问题
  - 性能显著低于预期的情况
  - 需要及时修复的安全隐患

- P2: 非核心功能问题（影响用户体验）
  - 次要功能的缺陷
  - UI/UX相关的问题
  - 性能优化需求
  - 可用性改进项

- P3: 优化类问题（可延后处理）
  - 代码质量优化
  - 文档完善
  - 小功能改进
  - 非紧急的性能优化

### 1.4 状态标记
- Not Started: 未开始
- In Progress: 进行中
- Completed: 已完成
- Failed: 未通过
- Blocked: 被阻塞

### 1.5 测试环境
- 操作系统: Linux
- Python版本: 3.8+
- 数据库: MySQL 8.0
- 缓存: Redis 6.0
- 搜索引擎: Elasticsearch 7.x

### 1.6 测试工具
- pytest==8.1.1
- pytest-django==4.8.0
- pytest-cov==5.0.0
- factory-boy==3.3.0
- faker==24.3.0
- coverage==7.4.3
- freezegun==1.4.0
- pytest-mock==3.12.0
- pytest-xdist==3.5.0
- pytest-sugar==1.0.0
- pytest-timeout==2.3.1

## 2. P0级测试计划（阻塞性问题）

### 2.1 认证核心服务

#### TC-AUTH-001: 用户登录流程
- **优先级**: P0
- **状态**: Completed
- **前置条件**: 
  - 系统中存在有效的用户账号
  - 数据库和缓存服务正常运行
- **测试步骤**:
  1. 使用正确的用户名和密码登录
  2. 使用错误的密码登录
  3. 使用不存在的用户名登录
  4. 使用已被封禁的账号登录
- **预期结果**:
  1. 正确凭证登录成功，返回有效token ✅
  2. 错误密码登录失败，返回密码错误提示 ✅
  3. 不存在用户名登录失败，返回用户不存在提示 ✅
  4. 封禁账号登录失败，返回账号已封禁提示 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 登录流程安全性验证完成 ✅
  - 错误处理机制完善 ✅
  - Token生成和验证正确 ✅
  - 用户状态检查正确实现 ✅
  - **测试要点**:
    1. 认证安全：密码加密、Token生成、会话管理
    2. 错误处理：异常响应、错误提示、日志记录
    3. 性能验证：响应时间、并发处理、资源消耗
    4. 安全防护：防暴力破解、账号锁定、异常检测
    5. 状态管理：登录状态、权限分配、会话维护

#### TC-AUTH-002: JWT Token验证
- **优先级**: P0
- **状态**: Completed
- **前置条件**: 
  - 用户已成功登录
  - 系统持有有效的JWT token
- **测试步骤**:
  1. 使用有效token访问受保护接口
  2. 使用过期token访问接口
  3. 使用无效token访问接口
  4. 使用被加入黑名单的token访问
- **预期结果**:
  1. 有效token可以正常访问接口 ✅
  2. 过期token返回过期错误 ✅
  3. 无效token返回验证失败错误 ✅
  4. 黑名单token被拒绝访问 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - Token验证机制安全可靠 ✅
  - 过期处理正确实现 ✅
  - 黑名单机制有效运作 ✅
  - 错误响应格式规范 ✅
  - **测试要点**:
    1. Token验证：签名验证、过期检查、权限验证
    2. 安全机制：刷新机制、黑名单处理、并发控制
    3. 性能测试：验证效率、缓存利用、资源开销
    4. 异常处理：错误响应、日志记录、安全预警
    5. 可用性：服务降级、故障恢复、监控告警

### 2.2 数据库服务

#### TC-DB-001: 数据库连接池
- **优先级**: P0
- **状态**: Completed
- **前置条件**:
  - MySQL服务正常运行
  - 连接池配置完成
- **测试步骤**:
  1. 测试连接池初始化
  2. 并发请求获取连接
  3. 测试连接超时处理
  4. 测试连接释放机制
  5. 测试连接池满载情况
- **预期结果**:
  1. 连接池正确初始化 ✅
  2. 并发请求正常处理 ✅
  3. 超时情况正确处理 ✅
  4. 连接正确释放回池 ✅
  5. 满载时请求正确排队 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 连接池性能表现良好 ✅
  - 资源管理机制有效 ✅
  - 并发处理稳定可靠 ✅
  - 异常处理机制完善 ✅
  - **测试要点**:
    1. 连接管理：初始化、动态扩容、释放回收
    2. 并发控制：连接分配、等待队列、超时处理
    3. 性能监控：连接使用率、响应时间、资源消耗
    4. 故障处理：异常恢复、重试机制、降级策略
    5. 资源优化：连接复用、空闲处理、负载均衡

#### TC-DB-002: 数据库事务
- **优先级**: P0
- **状态**: Passed ✅
- **前置条件**:
  - 数据库服务正常
  - 测试数据已准备
- **测试步骤**:
  1. 执行单表事务操作
  2. 执行多表事务操作
  3. 测试事务回滚
  4. 测试事务隔离级别
  5. 测试死锁处理
- **预期结果**:
  1. 单表事务正确提交或回滚 ✅
  2. 多表事务保持一致性 ✅
  3. 回滚操作正确执行 ✅
  4. 隔离级别正确生效 ✅
  5. 死锁被检测并处理 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 事务管理机制可靠 ✅
  - 数据一致性得到保证 ✅
  - 并发控制有效实现 ✅
  - 死锁处理机制完善 ✅
  - **测试要点**:
    1. 事务完整性：原子性、一致性、隔离性、持久性
    2. 并发控制：锁机制、死锁检测、超时处理
    3. 性能优化：事务拆分、批量处理、索引使用
    4. 异常处理：回滚机制、日志记录、错误恢复
    5. 监控告警：性能监控、异常检测、资源使用

### 2.3 缓存服务

#### TC-CACHE-001: Redis连接管理
- **优先级**: P0
- **状态**: Passed ✅
- **前置条件**:
  - Redis服务正常运行
  - 缓存配置完成
- **测试步骤**:
  1. 测试Redis连接建立
  2. 测试连接池管理
  3. 测试连接失败恢复
  4. 测试连接超时处理
  5. 测试哨兵模式切换
- **预期结果**:
  1. 连接正常建立 ✅
  2. 连接池正确管理连接 ✅
  3. 连接失败后自动恢复 ✅
  4. 超时情况正确处理 ✅
  5. 主从切换正常进行 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 连接管理机制稳定 ✅
  - 故障恢复功能有效 ✅
  - 超时处理机制完善 ✅
  - 高可用性得到保证 ✅
  - **测试要点**:
    1. 连接管理：连接建立、池化管理、自动重连
    2. 高可用性：主从切换、哨兵监控、故障转移
    3. 性能优化：连接复用、管道处理、批量操作
    4. 异常处理：超时重试、故障恢复、降级策略
    5. 监控告警：性能监控、故障检测、资源使用

## 3. P1级测试计划（核心功能）

### 3.1 用户管理

#### TC-AUTH-003: 用户注册流程
- **优先级**: P1
- **状态**: Passed ✅
- **前置条件**:
  - 系统正常运行
  - 数据库可写入
- **测试步骤**:
  1. 使用有效信息注册新用户
  2. 使用已存在的用户名注册
  3. 使用无效的邮箱格式注册
  4. 使用不符合要求的密码注册
- **预期结果**:
  1. 有效信息注册成功 ✅
  2. 重复用户名注册失败 ✅
  3. 无效邮箱格式注册失败 ✅
  4. 不合格密码注册失败 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 数据验证机制有效 ✅
  - 错误处理规范完整 ✅
  - 用户信息安全存储 ✅
  - 注册流程符合规范 ✅
  - **测试要点**:
    1. 数据验证：字段验证、格式检查、唯一性校验
    2. 安全机制：密码加密、信息脱敏、防注入处理
    3. 性能测试：响应时间、并发注册、资源消耗
    4. 业务逻辑：注册流程、邮件验证、账号激活
    5. 异常处理：错误提示、日志记录、回滚机制

### 3.2 新闻管理

#### TC-NEWS-001: 新闻CRUD操作
- **优先级**: P1
- **状态**: Passed ✅
- **前置条件**:
  - 用户已登录
  - 具有相应权限
- **测试步骤**:
  1. 创建新闻文章
  2. 读取新闻详情
  3. 更新新闻内容
  4. 删除新闻文章
  5. 批量操作新闻
- **预期结果**:
  1. 新闻创建成功 ✅
  2. 正确显示新闻信息 ✅
  3. 更新内容正确保存 ✅
  4. 删除操作正确执行 ✅
  5. 批量操作正确完成 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 新闻管理功能完整实现 ✅
  - 数据一致性得到保证 ✅
  - 权限控制正确实现 ✅
  - 错误处理机制完善 ✅
  - **测试要点**:
    1. 新闻创建：验证必填字段、可选字段、字段验证
    2. 新闻读取：验证数据完整性、字段映射、关联数据
    3. 新闻更新：验证字段更新、状态变更、历史记录
    4. 新闻删除：验证软删除、关联处理、权限控制
    5. 批量操作：验证并发处理、事务完整性、性能表现

### 3.3 搜索服务

#### TC-SEARCH-001: 新闻搜索功能
- **优先级**: P1
- **状态**: Passed ✅
- **前置条件**:
  - Elasticsearch服务正常运行
  - 索引数据已建立
- **测试步骤**:
  1. 基础关键词搜索 ✅
  2. 高级条件过滤 ✅
  3. 分页获取结果 ✅
  4. 结果排序功能 ✅
  5. 搜索建议功能 ✅
- **预期结果**:
  1. 关键词搜索结果准确 ✅
  2. 过滤条件正确应用 ✅
  3. 分页功能正常工作 ✅
  4. 排序功能正确执行 ✅
  5. 搜索建议相关且及时 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 搜索功能完整实现 ✅
  - 过滤和排序正确工作 ✅
  - 分页机制正确实现 ✅
  - 搜索建议功能完善 ✅
  - **测试要点**:
    1. 搜索准确性：关键词匹配、相关度排序、高亮显示
    2. 过滤功能：状态过滤、时间范围、标签过滤
    3. 分页性能：分页加载、数据一致性、响应时间
    4. 排序机制：多字段排序、排序稳定性、自定义排序
    5. 搜索建议：实时响应、相关性、权重计算

### 3.4 AI服务

#### TC-AI-001: 文本分析服务
- **优先级**: P1
- **状态**: Passed ✅
- **前置条件**:
  - OpenAI API配置正确
  - 测试数据准备完成
  - Redis缓存服务正常运行
  - 测试数据库可用
- **测试步骤**:
  1. 情感分析处理
     - 测试正常文本的情感分析 ✅
     - 测试空内容的错误处理 ✅
     - 测试超长文本的处理 ✅
     - 测试API调用失败的情况 ✅
     - 测试缓存机制 ✅
  2. 关键词提取
     - 测试正常文本的关键词提取 ✅
     - 测试空内容的错误处理 ✅
     - 测试关键词数量和权重计算 ✅
     - 测试多语言文本处理 ✅
     - 测试结果缓存机制 ✅
  3. 文本摘要生成
     - 测试正常文本的摘要生成 ✅
     - 测试空内容的错误处理 ✅
     - 测试长文本的摘要质量 ✅
     - 测试摘要长度控制 ✅
     - 测试缓存机制 ✅
  4. 批量分析任务
     - 测试多篇文章的并发分析 ✅
     - 测试任务进度追踪 ✅
     - 测试失败重试机制 ✅
     - 测试资源限制处理 ✅
     - 测试结果聚合 ✅
  5. 分析结果存储
     - 测试结果持久化 ✅
     - 测试历史记录查询 ✅
     - 测试结果更新机制 ✅
     - 测试存储容量管理 ✅
     - 测试数据一致性 ✅
- **预期结果**:
  1. 情感分析结果准确
     - 返回正确的情感倾向(positive/negative/neutral) ✅
     - 包含合理的置信度分数(0-1) ✅
     - 错误情况有适当的异常处理 ✅
     - 缓存机制正常工作 ✅
  2. 关键词提取合理
     - 提取的关键词数量在预期范围内 ✅
     - 关键词权重计算合理 ✅
     - 返回格式符合规范 ✅
     - 缓存机制有效 ✅
  3. 摘要生成完整
     - 生成的摘要语义完整 ✅
     - 长度符合限制要求 ✅
     - 包含文章主要信息 ✅
     - 缓存机制正常 ✅
  4. 批量任务正常执行
     - 任务创建和执行正常 ✅
     - 进度追踪准确 ✅
     - 失败任务正确处理 ✅
     - 结果正确聚合 ✅
  5. 结果正确保存
     - 分析结果持久化成功 ✅
     - 历史记录可查询 ✅
     - 更新操作正确执行 ✅
     - 数据一致性保持 ✅
- **测试结果**:
  - 情感分析功能测试通过 ✅
  - 关键词提取功能测试通过 ✅
  - 摘要生成功能测试通过 ✅
  - 批量分析功能测试通过 ✅
  - 结果存储功能测试通过 ✅
  - **测试要点**:
    1. 功能完整性：API调用、结果解析、错误处理 ✅
    2. 性能表现：响应时间、并发处理、资源消耗 ✅
    3. 可靠性：异常恢复、数据一致性、服务降级 ✅
    4. 安全性：API认证、数据加密、访问控制 ✅
    5. 可扩展性：服务扩容、任务调度、负载均衡 ✅

### 3.5 监控服务

#### TC-MONITOR-001: 系统监控功能
- **优先级**: P1
- **状态**: Passed ✅
- **前置条件**:
  - 监控服务正常运行
  - 数据库可写入
  - 用户已认证
  - Redis缓存服务正常运行
- **测试步骤**:
  1. 系统指标测试
     - 创建和获取系统指标（CPU使用率）
     - 验证指标数据的正确性
  2. 告警规则管理
     - 创建告警规则
     - 读取告警规则详情
     - 更新告警规则配置
     - 删除告警规则
  3. 告警历史生命周期
     - 创建告警历史记录
     - 确认告警状态
     - 解决告警问题
     - 验证时间戳记录
  4. 错误日志管理
     - 创建错误日志记录
     - 获取错误日志列表
     - 验证日志详情
  5. 系统健康状态检查
     - 创建系统指标数据
     - 检查系统健康状态
     - 验证健康检查结果
- **预期结果**:
  1. 系统指标管理
     - 成功创建系统指标 ✅
     - 正确获取指标数据 ✅
     - 指标值准确记录 ✅
  2. 告警规则功能
     - 告警规则创建成功 ✅
     - 规则配置正确保存 ✅
     - 更新和删除操作正常 ✅
  3. 告警历史记录
     - 告警状态变更正确 ✅
     - 时间戳记录准确 ✅
     - 生命周期管理完整 ✅
  4. 错误日志功能
     - 日志记录完整准确 ✅
     - 日志查询正常工作 ✅
     - 日志分类正确 ✅
  5. 健康状态检查
     - 健康检查正常执行 ✅
     - 状态信息完整准确 ✅
     - 检查项目覆盖全面 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 监控功能完整实现 ✅
  - 数据采集准确可靠 ✅
  - 告警机制正常工作 ✅
  - 日志管理功能完善 ✅
  - **测试要点**:
    1. 功能完整性：指标采集、告警管理、日志记录、健康检查
    2. 数据准确性：指标值准确、状态正确、时间戳精确
    3. 性能表现：响应时间、数据处理、资源消耗
    4. 可靠性：服务稳定、数据一致、异常处理
    5. 安全性：访问控制、数据保护、操作审计

## 4. P2级测试计划（非核心功能）

### 4.1 用户功能

#### TC-AUTH-004: 密码重置功能
- **优先级**: P2
- **状态**: Passed ✅
- **前置条件**:
  - 系统中存在注册用户
  - 邮件服务配置正确
- **测试步骤**:
  1. 请求密码重置
  2. 验证重置邮件发送
  3. 使用重置链接修改密码
  4. 使用新密码登录
  5. 测试并发重置请求
- **预期结果**:
  1. 重置请求成功提交 ✅
  2. 重置邮件成功发送 ✅
  3. 密码成功修改 ✅
  4. 新密码可以正常登录 ✅
  5. 并发请求正确处理 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 重置流程安全可靠 ✅
  - 邮件发送及时准确 ✅
  - 密码修改机制安全 ✅
  - 并发处理机制完善 ✅
  - **测试要点**:
    1. 安全验证：身份验证、链接有效期、防暴力破解
    2. 邮件服务：发送可靠性、模板正确性、超时处理
    3. 密码管理：加密存储、强度验证、历史记录
    4. 并发控制：请求限制、状态同步、冲突处理
    5. 用户体验：操作流程、提示信息、异常处理

### 4.2 爬虫功能

#### TC-CRAWLER-001: 爬虫配置管理
- **优先级**: P2
- **状态**: Passed ✅
- **前置条件**:
  - 爬虫服务正常运行
  - 测试目标网站可访问
- **测试步骤**:
  1. 创建爬虫配置
  2. 修改爬虫规则
  3. 启动爬虫任务
  4. 暂停爬虫任务
  5. 查看任务状态
- **预期结果**:
  1. 配置创建成功 ✅
  2. 规则修改生效 ✅
  3. 任务正常启动 ✅
  4. 任务成功暂停 ✅
  5. 状态查看准确 ✅
- **测试结果**:
  - 所有测试用例均已通过 ✅
  - 配置管理功能完整实现 ✅
  - 任务控制机制可靠 ✅
  - 状态监控正常工作 ✅
  - 错误处理机制完善 ✅
  - **测试要点**:
    1. 配置管理：创建、修改、启用、禁用配置
    2. 任务控制：启动、暂停、恢复、取消任务
    3. 状态监控：任务状态、进度追踪、结果统计
    4. 错误处理：网络异常、解析错误、超时处理
    5. 数据验证：内容完整性、格式正确性、去重处理

### 4.3 新闻分类管理

#### TC-NEWS-002: 新闻分类功能
- **优先级**: P2
- **状态**: Not Started
- **前置条件**:
  - 用户已登录
  - 具有分类管理权限
- **测试步骤**:
  1. 创建新闻分类
  2. 编辑分类信息
  3. 删除新闻分类
  4. 分类新闻关联
  5. 分类统计查看
- **预期结果**:
  1. 分类创建成功
  2. 信息修改生效
  3. 删除操作完成
  4. 关联关系正确
  5. 统计数据准确

## 5. 测试执行记录

### 5.1 测试进度表
| 测试用例ID | 优先级 | 状态 | 执行时间 | 执行人 | 备注 |
|------------|--------|------|----------|--------|------|
| TC-AUTH-001 | P0 | Passed ✅ | 2025-01-15 | denny | 用户登录测试通过（已复测） |
| TC-AUTH-002 | P0 | Passed ✅ | 2025-01-15 | denny | JWT Token验证测试通过（已复测） |
| TC-DB-001  | P0 | Passed ✅ | 2025-01-15 | denny | 数据库连接池测试通过（已复测） |
| TC-DB-002  | P0 | Passed ✅ | 2025-01-15 | denny | 数据库事务测试通过（已复测） |
| TC-CACHE-001| P0 | Passed ✅ | 2025-01-15 | denny | Redis连接管理测试通过（已复测） |
| TC-AUTH-003 | P1 | Passed ✅ | 2025-01-15 | denny | 用户注册测试通过（已复测） |
| TC-NEWS-001| P1 | Passed ✅ | 2025-01-15 | denny | 新闻CRUD和批量操作测试通过（已复测） |
| TC-SEARCH-001| P1 | Passed ✅ | 2025-01-16 | denny | 新闻搜索功能测试通过（已复测） |
| TC-AI-001  | P1 | Passed ✅ | 2025-01-17 | denny | AI文本分析服务测试通过（已复测） |
| TC-MONITOR-001| P1 | Passed ✅ | 2025-01-18 | denny | 系统监控功能测试通过，包括系统指标采集、告警规则管理、告警历史记录、错误日志管理和健康状态检查等功能均已验证 |
| TC-AUTH-004 | P2 | Passed ✅ | 2025-01-15 | denny | 密码重置和并发认证测试通过（已复测） |
| TC-CRAWLER-001| P2 | Passed ✅ | 2025-01-21 | denny | 爬虫配置管理测试通过，包括配置管理、任务控制和状态监控等功能均已验证 |
| TC-NEWS-002| P2 | Not Started | | | |

### 5.2 问题记录表
| 问题ID | 关联用例 | 优先级 | 状态 | 描述 | 解决方案 |
|--------|----------|---------|------|------|----------|
| | | | | | |

## 6. 测试报告模板

### 6.1 测试概要
- 测试范围
- 测试环境
- 测试工具
- 测试时间

### 6.2 测试结果
- 测试用例统计
- 缺陷统计分析
- 测试覆盖率
- 性能指标

### 6.3 问题记录
- 问题描述
- 重现步骤
- 影响范围
- 解决方案

### 6.4 改进建议
- 测试过程优化
- 自动化建议
- 性能优化
- 安全加固 