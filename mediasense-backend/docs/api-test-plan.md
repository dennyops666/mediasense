# MediaSense API 测试计划

## 1. 测试概述

### 1.1 测试目标
- 验证所有API接口的功能正确性
- 确保API响应格式符合规范
- 验证API的安全性和认证机制
- 测试API的性能和并发处理能力
- 确保错误处理机制的有效性

### 1.2 测试范围
- 接口功能测试
- 认证和授权测试
- 参数验证测试
- 响应格式测试
- 错误处理测试
- 性能和负载测试

### 1.3 优先级说明
- P0：核心功能，必须测试
- P1：重要功能，应该测试
- P2：次要功能，可以测试

### 1.4 状态标记
- Not Started ❌：未开始
- In Progress 🔄：进行中
- Passed ✅：通过
- Failed ❌：失败
- Blocked 🚫：阻塞

## 2. P0级测试计划

### 2.1 认证服务测试

#### TC-API-AUTH-001：用户认证接口测试
- **优先级**：P0
- **状态**：Not Started ❌
- **前置条件**：
  1. 系统正常运行
  2. 数据库中存在测试用户
- **测试步骤**：
  1. 测试登录接口 `/v1/auth/token/`
  2. 测试令牌刷新接口 `/v1/auth/token/refresh/`
  3. 测试令牌验证接口 `/v1/auth/token/verify/`
  4. 验证无效令牌的处理
- **预期结果**：
  1. 登录成功返回access token和refresh token
  2. 令牌刷新成功返回新的access token
  3. 令牌验证正确反映token状态
  4. 无效令牌请求被正确拒绝

### 2.2 通用响应格式测试

#### TC-API-COMMON-001：API响应格式测试
- **优先级**：P0
- **状态**：Not Started ❌
- **前置条件**：
  1. 系统正常运行
  2. 已获取有效的认证token
- **测试步骤**：
  1. 测试成功响应格式
  2. 测试客户端错误响应格式
  3. 测试服务器错误响应格式
  4. 验证响应字段的完整性
- **预期结果**：
  1. 成功响应包含code、message和data字段
  2. 错误响应包含code、message和errors字段
  3. 所有响应均为JSON格式

## 3. P1级测试计划

### 3.1 新闻模块API测试

#### TC-API-NEWS-001：新闻文章CRUD测试
- **优先级**：P1
- **状态**：Not Started ❌
- **前置条件**：
  1. 已通过认证
  2. 具有新闻管理权限
- **测试步骤**：
  1. 测试新闻文章创建
  2. 测试新闻文章读取
  3. 测试新闻文章更新
  4. 测试新闻文章删除
  5. 测试批量操作功能
- **预期结果**：
  1. 所有CRUD操作正常完成
  2. 批量操作正确处理多条数据
  3. 响应格式符合规范

### 3.2 监控模块API测试

#### TC-API-MONITOR-001：系统监控接口测试
- **优先级**：P1
- **状态**：Not Started ❌
- **前置条件**：
  1. 已通过认证
  2. 监控服务正常运行
- **测试步骤**：
  1. 测试系统状态概览接口
  2. 测试健康检查接口
  3. 测试性能指标接口
  4. 测试告警规则管理
  5. 测试告警历史查询
- **预期结果**：
  1. 系统状态数据准确
  2. 健康检查正确反映服务状态
  3. 告警功能正常工作

### 3.3 搜索模块API测试

#### TC-API-SEARCH-001：新闻搜索功能测试
- **优先级**：P1
- **状态**：Not Started ❌
- **前置条件**：
  1. 已通过认证
  2. 存在足够的测试数据
  3. 搜索服务正常运行
- **测试步骤**：
  1. 测试基础搜索功能
  2. 测试高级搜索参数
  3. 测试搜索建议功能
  4. 测试搜索历史功能
  5. 测试热门搜索功能
- **预期结果**：
  1. 搜索结果准确
  2. 高级参数正确过滤结果
  3. 搜索建议及时准确
  4. 历史记录正确维护

### 3.4 AI服务模块API测试

#### TC-API-AI-001：AI分析服务测试
- **优先级**：P1
- **状态**：Passed ✅
- **前置条件**：
  1. 已通过认证
  2. AI服务正常运行
  3. 存在测试用的分析规则
- **测试步骤**：
  1. 测试文本分析接口
  2. 测试规则管理功能
  3. 测试批量分析任务
  4. 测试分析调度功能
  5. 测试通知管理功能
- **预期结果**：
  1. 分析结果准确
  2. 规则管理正常工作
  3. 批量任务正确执行
  4. 调度功能按时运行
- **实际结果**：
  1. 24个测试用例全部通过
  2. 覆盖所有核心功能：
     - 文本分析（情感分析、关键词提取、摘要生成）
     - 规则管理（创建、更新、删除）
     - 批量任务处理
     - 分析计划管理
     - 通知系统
  3. 性能和稳定性符合预期
  4. 仅有5个Django 6.0弃用警告，不影响功能

## 4. P2级测试计划

### 4.1 爬虫模块API测试

#### TC-API-CRAWLER-001：爬虫管理接口测试
- **优先级**：P2
- **状态**：Not Started ❌
- **前置条件**：
  1. 已通过认证
  2. 爬虫服务正常运行
- **测试步骤**：
  1. 测试爬虫配置管理
  2. 测试爬虫任务控制
  3. 测试配置启用/禁用
  4. 测试任务重试功能
- **预期结果**：
  1. 配置管理正常工作
  2. 任务控制准确执行
  3. 状态变更正确反映

## 5. 测试执行记录

### 5.1 测试进度表

| 测试用例ID | 优先级 | 状态 | 执行时间 | 执行人 | 备注 |
|------------|--------|------|----------|--------|------|
| TC-API-AUTH-001 | P0 | Not Started ❌ | - | - | - |
| TC-API-COMMON-001 | P0 | Not Started ❌ | - | - | - |
| TC-API-NEWS-001 | P1 | Not Started ❌ | - | - | - |
| TC-API-MONITOR-001 | P1 | Not Started ❌ | - | - | - |
| TC-API-SEARCH-001 | P1 | Not Started ❌ | - | - | - |
| TC-API-AI-001 | P1 | Passed ✅ | 2024-01-24 | AI Team | 全部24个测试用例通过 |
| TC-API-CRAWLER-001 | P2 | Not Started ❌ | - | - | - |

### 5.2 问题记录表

| 问题ID | 关联测试用例 | 问题描述 | 优先级 | 状态 | 解决方案 |
|--------|--------------|----------|--------|------|----------|

## 6. 测试报告模板

### 6.1 测试概述
- 测试范围
- 测试环境
- 测试周期
- 测试工具

### 6.2 测试结果
- 测试用例执行情况
- 问题统计分析
- 测试结果评估

### 6.3 问题记录
- 主要问题描述
- 解决方案
- 遗留问题

### 6.4 改进建议
- 功能改进建议
- 性能优化建议
- 测试过程改进建议

## 测试范围

本测试计划涵盖以下模块的API测试：
1. 认证服务 (Authentication Service)
2. AI服务 (AI Service)
3. 爬虫服务 (Crawler Service)

## 测试优先级

测试用例按以下优先级划分：
- P0：核心功能，必须测试
- P1：重要功能，应该测试
- P2：次要功能，可以测试

## AI服务测试用例

### P0级别
1. ✅ 测试文章分析功能 (`test_analyze_article`)
   - ✅ 验证情感分析结果
   - ✅ 验证关键词提取结果
   - ✅ 验证摘要生成结果

2. ✅ 测试分析规则管理 (`test_create_analysis_rule`, `test_update_analysis_rule`)
   - ✅ 创建规则
   - ✅ 更新规则
   - ✅ 删除规则

3. ✅ 测试批量分析任务 (`test_create_batch_task`, `test_batch_task_control`)
   - ✅ 创建批量任务
   - ✅ 控制任务状态
   - ✅ 获取任务结果

### P1级别
1. ✅ 测试分析计划管理 (`test_create_analysis_schedule`)
   - ✅ 创建分析计划
   - ✅ 更新计划配置
   - ✅ 启用/禁用计划

2. ✅ 测试通知管理 (`test_notification_management`)
   - ✅ 订阅通知
   - ✅ 标记通知已读
   - ✅ 取消订阅

3. ✅ 测试缓存机制 (`test_sentiment_analysis_cache`, `test_cache_invalidation`)
   - ✅ 验证缓存命中
   - ✅ 验证缓存失效
   - ✅ 验证缓存更新

### P2级别
1. ✅ 测试错误处理 (`test_error_handling`)
   - ✅ API错误处理
   - ✅ 速率限制处理
   - ✅ 无效输入处理

2. ✅ 测试并发处理 (`test_concurrent_analysis`)
   - ✅ 并发分析请求
   - ✅ 资源竞争处理
   - ✅ 性能监控

## 测试进度表

| 模块 | 计划用例数 | 已完成用例数 | 通过用例数 | 失败用例数 | 完成率 | 通过率 |
|------|------------|--------------|------------|------------|---------|---------|
| AI服务 | 24 | 24 | 24 | 0 | 100% | 100% |
| 认证服务 | - | - | - | - | - | - |
| 爬虫服务 | - | - | - | - | - | - |

## 测试环境

- Python版本：3.12.3
- Django版本：5.1.4
- 测试框架：pytest 8.3.4
- 数据库：MySQL 8.0
- 缓存：Redis 6.0

## 测试结果总结

### AI服务测试结果
- 所有24个测试用例全部通过
- 测试覆盖了所有P0、P1和P2级别的功能
- 主要功能包括：
  * 文本分析（情感分析、关键词提取、摘要生成）
  * 规则管理
  * 批量任务处理
  * 分析计划管理
  * 通知系统
  * 缓存机制
  * 错误处理
  * 并发处理

### 遗留问题
- 有5个Django 6.0弃用警告，需要在后续版本中处理
- URL转换器注册方式需要在Django 6.0发布前更新

### 后续计划
1. 继续进行认证服务的测试
2. 开始爬虫服务的测试
3. 解决Django 6.0弃用警告
4. 进行性能测试和负载测试 